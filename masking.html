

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Masking and null values &mdash; ATpy 0.9.6 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ATpy 0.9.6 documentation" href="index.html" />
    <link rel="next" title="Custom reading/writing" href="developers.html" />
    <link rel="prev" title="Table Sets" href="table_sets.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="developers.html" title="Custom reading/writing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="table_sets.html" title="Table Sets"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">ATpy 0.9.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/atpy_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Masking and null values</a><ul>
<li><a class="reference internal" href="#null-values">Null values</a></li>
<li><a class="reference internal" href="#masking">Masking</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="table_sets.html"
                        title="previous chapter">Table Sets</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="developers.html"
                        title="next chapter">Custom reading/writing</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/masking.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="masking-and-null-values">
<span id="maskingandnull"></span><h1>Masking and null values<a class="headerlink" href="#masking-and-null-values" title="Permalink to this headline">¶</a></h1>
<p>It is often useful to be able to define missing or invalid values in a table. There are currently two ways to do this in ATpy, <a class="reference internal" href="#null"><em>Null values</em></a>, and <a class="reference internal" href="#masking"><em>Masking</em></a>. The preferred way is to use Masking, but this requires at least NumPy 1.4.1 in most cases, and the latest svn version of NumPy for SQL database input/output. Therefore, for version 0.9.4 of ATpy, the default is to use the Null value method. To opt-in to using masked arrays, specify the <tt class="docutils literal"><span class="pre">masked=True</span></tt> argument when creating a <tt class="docutils literal"><span class="pre">Table</span></tt> instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;example.fits.gz&#39;</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>In future, once NumPy 1.5.0 is out, we will switch over to using masked arrays by default, and will slowly phase out the Null value method.</p>
<p>If you want to set the default for masking to be on or off for a whole script, this can be done using the <tt class="docutils literal"><span class="pre">set_masked_default</span></tt> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">atpy</span>
<span class="n">atpy</span><span class="o">.</span><span class="n">set_masked_default</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to set the default for masking on a user-level, create a file named <tt class="docutils literal"><span class="pre">~/.atpyrc</span></tt> in your home directory, containing:</p>
<div class="highlight-python"><pre>[general]
masked_default:yes</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">set_masked_default</span></tt> function overrides the <tt class="docutils literal"><span class="pre">.atpyrc</span></tt> file, and the <tt class="docutils literal"><span class="pre">masked=</span></tt> argument in Table overrides both the <tt class="docutils literal"><span class="pre">set_masked_default</span></tt> function and the <tt class="docutils literal"><span class="pre">.atpyrc</span></tt> file.</p>
<div class="section" id="null-values">
<span id="null"></span><h2>Null values<a class="headerlink" href="#null-values" title="Permalink to this headline">¶</a></h2>
<p>The basic idea behind this method is to specify a special value in each column that will signify missing or invalid data. To specify the Null value for a column, use the <tt class="docutils literal"><span class="pre">null</span></tt> argument in <tt class="docutils literal"><span class="pre">add_column</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">null</span><span class="o">=-</span><span class="mf">999.</span><span class="p">)</span>
</pre></div>
</div>
<p>Following this, if the table is written out to a file or database, this null value will be stored.</p>
<p>This method is generally unreliable, especially for floating point values, and does not allow users to easily distinguish between invalid and missing values.</p>
</div>
<div class="section" id="masking">
<span id="id1"></span><h2>Masking<a class="headerlink" href="#masking" title="Permalink to this headline">¶</a></h2>
<p>NumPy supports masked arrays, where specific elements of an array can be properly masked by using a <em>mask</em> - a boolean array. There are several advantages to using this:</p>
<ul class="simple">
<li>The mask is unrelated to the value in the cell - any cell can be masked, not
just all cells with a specific value</li>
<li>It is possible to distinguish between invalid (e.g. NaN) and missing values</li>
<li>Values can easily be unmasked (although when writing to a file/database, the
&#8216;old&#8217; values are lost for masked elements).</li>
<li>NumPy provides masked versions of many functions, for example <tt class="docutils literal"><span class="pre">sum</span></tt>,
<tt class="docutils literal"><span class="pre">mean</span></tt>, or <tt class="docutils literal"><span class="pre">median</span></tt>, which means that it is easy to correctly compute
statistics on masked arrays, ignoring the masked values.</li>
</ul>
<p>To specify the mask of a column, use the <tt class="docutils literal"><span class="pre">mask</span></tt> argument in <tt class="docutils literal"><span class="pre">add_column</span></tt>. To do the equivalent to the example in <a class="reference internal" href="#null"><em>Null values</em></a>, use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">time</span><span class="o">==-</span><span class="mf">999.</span><span class="p">)</span>
</pre></div>
</div>
<p>When writing out to certain file/database formats, a masked value has to be given a specific value - this is called a <em>fill</em> value. To set the fill value, simply use the <tt class="docutils literal"><span class="pre">fill</span></tt> argument when adding data to a column:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">time</span><span class="o">==-</span><span class="mf">999.</span><span class="p">,</span> <span class="n">fill</span><span class="o">=-</span><span class="mf">999.</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, if the table is written out to an IPAC table, the value of -999. will be used for masked values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When implementing this in ATpy, we discovered a few bugs in the masked
structured implementation of NumPy, which have now been fixed. Therefore,
we recommend using the latest svn version of NumPy if you want to use
masked arrays.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="developers.html" title="Custom reading/writing"
             >next</a> |</li>
        <li class="right" >
          <a href="table_sets.html" title="Table Sets"
             >previous</a> |</li>
        <li><a href="index.html">ATpy 0.9.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, Eli Bressert and Thomas Robitaille.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>